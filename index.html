<!doctype html>
<html>
  <head>
    <style>
      :root {
        --player-height: 7.5dvw;
        --player-left: 0%;
        --player-top: 0%;
        --player-width: 7.5dvw;
        --playing-field-border-width: 1px;
      }

      body {
        align-items: center;
        background-color: cyan;
        display: grid;
        grid-template-rows: min-content 1fr;
        height: 100dvh;
        justify-items: center;
        margin: 0;
        user-select: none;
      }

      #controls {
        align-items: center;
        display: flex;
        flex-direction: column;
        padding-block-end: 1rem;
      }

      #octocat {
        /*
         * De speler op deze manier positioneren is niet helemaal gelijk over
         * het hele speelveld, aan de randen wordt een klein gebied
         * "samengevoegd". Zonder de `clamp` kan de speler voor de helft van de
         * breedte en/of hoogte buiten het speelveld vallen op de grens van het
         * speeldveld
         */
        left: clamp(
          0%,
          calc(var(--player-left) - 0.5 * var(--player-width)),
          100% - var(--player-width)
        );
        position: absolute;
        top: clamp(
          0%,
          calc(var(--player-top) - 0.5 * var(--player-height)),
          100% - var(--player-height)
        );
        transition: all 0.5s;
        width: var(--player-width);

        &:hover {
          cursor: grab;
        }
      }

      #playing-field {
        border: var(--playing-field-border-width) solid black;
        height: calc(100% - 2 * var(--playing-field-border-width));
        position: relative;
        width: calc(100% - 2 * var(--playing-field-border-width));
      }

      .hidden {
        display: none;
      }
    </style>
  </head>

  <body>
    <div id="controls">
      <p><span id="scoreHeader">Score</span>: <span id="scoreText">0</span></p>

      <button id="start">Start</button>
      <button class="hidden" id="stop">Stop</button>
    </div>

    <div id="playing-field">
      <img id="octocat" src="octocat.png" />
    </div>
  </body>

  <script>
    const octocat = document.getElementById("octocat");
    const playingField = document.getElementById("playing-field");
    const scoreHeader = document.getElementById("scoreHeader");
    const scoreText = document.getElementById("scoreText");
    const startButton = document.getElementById("start");
    const stopButton = document.getElementById("stop");

    startButton.addEventListener("click", startGame);
    stopButton.addEventListener("click", stopGame);

    let gameDuration = 30;
    let score;
    let seconds;
    let timer;

    function caughtIt() {
      score++;
      printScore();

      // Verplaats de Octocat direct zodra hij gevangen wordt. Anders kun je
      // gedurende de tijd dat hij niet beweegt blijven scoren
      moveIt();

      // Het aanroepen van `moveIt` zorgt ervoor dat de tijd verder gezet
      // wordt. Als je de Octocat vangt, dan krijg je de seconde dat hij niet
      // bewogen heeft terug
      resetTimer();
      seconds--;
    }

    function moveIt() {
      seconds++;

      playingField.style.setProperty(
        "--player-left",
        `${Math.random() * 100}%`,
      );
      playingField.style.setProperty("--player-top", `${Math.random() * 100}%`);

      if (seconds > gameDuration) {
        stopGame();
      }
    }

    function printScore() {
      scoreText.innerText = score;
    }

    function resetTimer() {
      // In het geval dat er een timer actief is, dan moet die eerst gestopt
      // worden aangezien anders de `moveIt` actie te vaak zal worden
      // aangeroepen
      if (timer) {
        clearInterval(timer);
      }

      timer = setInterval(moveIt, 1000);
    }

    function startGame() {
      scoreHeader.innerText = "Score";

      startButton.classList.add("hidden");
      stopButton.classList.remove("hidden");

      score = 0;
      printScore();

      seconds = 0;
      resetTimer();

      octocat.addEventListener("click", caughtIt);
    }

    function stopGame() {
      octocat.removeEventListener("click", caughtIt);
      clearInterval(timer);

      scoreHeader.innerText = "Uiteindelijke score";

      startButton.classList.remove("hidden");
      stopButton.classList.add("hidden");
    }
  </script>
</html>
